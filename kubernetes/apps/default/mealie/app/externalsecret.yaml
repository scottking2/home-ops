---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: mealie-pg-backup
  namespace: mealie
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword-connect
  target:
    name: mealie-pg-backup-secret
    creationPolicy: Owner
    template:
      engineVersion: v2
      metadata:
        labels:
          cnpg.io/reload: "true"
  data:
    - secretKey: uri
      remoteRef:
        key: mealie-pg
        property: POSTGRES_MEALIE_URI
    - secretKey: username
      remoteRef:
        key: mealie-pg
        property: MEALIE_PG_USER
    - secretKey: password
      remoteRef:
        key: mealie-pg
        property: MEALIE_PG_PASS
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: mealie-pg
  namespace: mealie
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword-connect
  target:
    name: mealie-pg-secret
    creationPolicy: Owner
    template:
      engineVersion: v2
      metadata:
        labels:
          cnpg.io/reload: "true"
  data:
    INIT_POSTGRES_DBNAME: mealie
    INIT_POSTGRES_HOST: &dbHost "${.POSTGRES_MEALIE_URI}"
    INIT_POSTGRES_USER: &dbUser "${.MEALIE_PG_USER}"
    INIT_POSTGRES_PASS: &dbPass "${MEALIE_PG_PASS}"
    INIT_POSTGRES_SUPER_PASS: "${POSTGRES_SUPER_PASS}"
    # App
    POSTGRES_USER: *dbUser
    POSTGRES_PASSWORD: *dbPass
    POSTGRES_SERVER: *dbHost
    POSTGRES_DB: mealie





